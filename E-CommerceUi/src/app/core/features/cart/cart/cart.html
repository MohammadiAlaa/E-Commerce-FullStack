<div class="container mt-5 pt-5 mb-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-dark">Shopping Cart</h2>
    <span class="badge bg-dark px-3 py-2 rounded-pill"> {{ cartProducts.length }} Items </span>
  </div>

  @if (cartProducts.length > 0) {
    <div
      class="alert shadow-sm border-0 animate__animated animate__fadeIn"
      [ngClass]="total >= FREE_SHIPPING_LIMIT ? 'alert-success' : 'alert-info'"
    >
      @if (total >= FREE_SHIPPING_LIMIT) {
        <i class="fa fa-circle-check me-2"></i> Congratulations! You've unlocked
        <strong>FREE SHIPPING</strong>
      } @else {
        <i class="fa fa-circle-info me-2"></i> Add
        <strong>{{ FREE_SHIPPING_LIMIT - total | number: '1.2-2' }} L.E</strong> more to get free
        delivery!
      }
    </div>

    <div class="row g-4">
      <div class="col-md-8">
        <div class="table-responsive bg-white rounded-4 shadow-sm p-3">
          <table class="table align-middle">
            <thead class="text-muted small uppercase">
              <tr>
                <th>Product</th>
                <th class="text-center">Price</th>
                <th class="text-center">Quantity</th>
                <th class="text-center">Total</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              @for (item of cartProducts; track item.id) {
                <tr class="border-bottom">
                  <td>
                    <div class="d-flex align-items-center">
                      <img
                        [src]="'https://localhost:7247' + item.item.imageUrl"
                        class="rounded-3 me-3 border"
                        width="60"
                        height="60"
                        style="object-fit: cover"
                      />
                      <div class="d-flex flex-column">
                        <span class="fw-bold">{{ item.item.name }}</span>
                        <a
                          [routerLink]="['/details', item.itemId]"
                          class="text-primary small text-decoration-none fw-semibold"
                        >
                          <i class="fa fa-info-circle me-1"></i>Details
                        </a>
                      </div>
                    </div>
                  </td>
                  <td class="text-center text-muted">
                    {{ item.item.discountPrice || item.item.price | number: '1.2-2' }} L.E
                  </td>

                  <td class="text-center">
                    <div
                      class="qty-control rounded-pill border d-inline-flex align-items-center bg-light px-2"
                    >
                      <button
                        class="btn btn-sm text-danger fw-bold"
                        (click)="minusQuantity(item.itemId, item.quantity)"
                      >
                        <i class="fa fa-minus"></i>
                      </button>
                      <span class="mx-3 fw-bold text-dark">{{ item.quantity }}</span>
                      <button
                        class="btn btn-sm text-success fw-bold"
                        (click)="plusQuantity(item.itemId)"
                      >
                        <i class="fa fa-plus"></i>
                      </button>
                    </div>
                  </td>

                  <td class="text-center fw-bold text-dark">
                    {{
                      (item.item.discountPrice || item.item.price) * item.quantity | number: '1.2-2'
                    }}
                    L.E
                  </td>
                  <td class="text-end">
                    <button
                      class="btn btn-link text-danger p-0"
                      (click)="deleteProduct(item.itemId)"
                    >
                      <i class="fa fa-trash-can fs-5"></i>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
          <div class="d-flex justify-content-start mt-3">
            <button class="btn btn-outline-danger btn-sm rounded-pill" (click)="clearAll()">
              <i class="fa fa-trash-alt me-2"></i>Clear Entire Cart
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card border-0 shadow-sm rounded-4 p-4 sticky-top" style="top: 100px">
          <h4 class="fw-bold mb-4">Order Summary</h4>
          <div class="d-flex justify-content-between mb-2">
            <span class="text-muted">Subtotal</span>
            <span class="fw-bold">{{ total | number: '1.2-2' }} L.E</span>
          </div>
          <div class="d-flex justify-content-between mb-4">
            <span class="text-muted">Shipping Fee</span>
            <span
              class="fw-bold"
              [ngClass]="total >= FREE_SHIPPING_LIMIT ? 'text-success' : 'text-dark'"
            >
              {{ total >= FREE_SHIPPING_LIMIT ? 'FREE' : SHIPPING_FEE + ' L.E' }}
            </span>
          </div>
          <hr class="text-muted opacity-25" />
          <div class="d-flex justify-content-between align-items-center mb-4">
            <span class="fs-5 fw-bold">Grand Total</span>
            <span class="fs-4 fw-bold text-primary">
              {{ total + (total >= FREE_SHIPPING_LIMIT ? 0 : SHIPPING_FEE) | number: '1.2-2' }} L.E
            </span>
          </div>
          <button
            class="btn btn-success btn-lg w-100 rounded-pill py-3 fw-bold shadow-sm"
            (click)="goToCheckout()"
          >
            PROCEED TO CHECKOUT <i class="fa fa-arrow-right ms-2"></i>
          </button>
          <button class="btn btn-light w-100 mt-3 rounded-pill" routerLink="/products">
            Continue Shopping
          </button>
        </div>
      </div>
    </div>
  } @else {
    <div
      class="text-center py-5 bg-white rounded-5 shadow-sm mt-4 animate__animated animate__zoomIn"
    >
      <div class="mb-4">
        <i class="fa fa-cart-shopping fa-5x text-light-emphasis opacity-25"></i>
      </div>
      <h3 class="fw-bold">Your cart is empty</h3>
      <p class="text-muted mb-4">Looks like you haven't added anything to your cart yet.</p>
      <button class="btn btn-primary px-5 py-3 rounded-pill fw-bold shadow" routerLink="/products">
        START SHOPPING
      </button>
    </div>
  }
</div>
<div class="padding"></div>
