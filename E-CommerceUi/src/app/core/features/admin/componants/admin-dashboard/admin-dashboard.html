<div class="container mt-5 pt-5 pb-5 animate__animated animate__fadeIn">
  <div
    class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 gap-3"
  >
    <div>
      <h2 class="fw-bold text-dark mb-1">
        <i class="fa fa-chart-line me-2 text-danger"></i>Control Panel
        <span class="badge bg-soft-success text-success status-badge ms-2">
          <i class="fa fa-circle fa-beat me-1"></i> LIVE
        </span>
      </h2>
      <p class="text-muted small mb-0">Live store performance and inventory metrics</p>
    </div>
    <div class="d-flex gap-2">
      <button
        class="btn btn-white shadow-sm border rounded-pill px-4 refresh-btn"
        (click)="loadDashboardData()"
        [disabled]="loading"
      >
        <i class="fa fa-sync-alt me-2" [class.fa-spin]="loading"></i> Refresh
      </button>
    </div>
  </div>

  <div class="row g-3 mb-5">
    <div class="col-auto">
      <button
        class="btn btn-dark rounded-pill px-4 shadow-sm action-btn"
        routerLink="/admin/orders"
      >
        <i class="fa fa-shopping-cart me-2"></i> Orders
      </button>
    </div>
    <div class="col-auto">
      <button
        class="btn btn-outline-primary rounded-pill px-4 shadow-sm admin-nav-btn nav-team"
        routerLink="/admin/users"
      >
        <i class="fa fa-users me-2"></i> Team
      </button>
    </div>
    <div class="col-auto">
      <button
        class="btn btn-outline-success rounded-pill px-4 shadow-sm admin-nav-btn"
        routerLink="/admin/categories"
      >
        <i class="fa fa-tags me-2"></i> Categories
      </button>
    </div>
  </div>

  @if (loading) {
    <div class="d-flex justify-content-center align-items-center my-5 py-5">
      <app-spinner></app-spinner>
    </div>
  } @else if (stats) {
    <div class="row g-4 mb-5">
      <div class="col-md-3">
        <div class="card border-0 shadow-premium bg-grad-blue text-white p-4 h-100">
          <h6 class="text-uppercase small fw-bold opacity-75">Total Revenue</h6>
          <h2 class="fw-extrabold mb-0">
            {{ stats.totalRevenue | number: '1.0-0' }} <small class="fs-6">EGP</small>
          </h2>
          <small class="opacity-50">From completed orders</small>
          <i class="fa fa-money-bill-trend-up icon-bg"></i>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 shadow-premium bg-grad-green text-white p-4 h-100">
          <h6 class="text-uppercase small fw-bold opacity-75">Active Tasks</h6>
          <h2 class="fw-extrabold mb-0">{{ stats.totalOrders }}</h2>
          <small class="opacity-50">Pending delivery/processing</small>
          <i class="fa fa-bag-shopping icon-bg"></i>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 shadow-premium bg-grad-orange text-white p-4 h-100">
          <h6 class="text-uppercase small fw-bold opacity-75">Inventory Alerts</h6>
          <h2 class="fw-extrabold mb-0">{{ stats.lowStockCount }}</h2>
          <small class="opacity-50">Items below 5 units</small>
          <i class="fa fa-triangle-exclamation icon-bg"></i>
        </div>
      </div>

      <div class="col-md-3">
        <div
          class="card border-0 shadow-premium bg-grad-red text-white p-4 h-100 cursor-pointer"
          (click)="showCancelReason('Check orders page for detailed cancellation logs.')"
        >
          <h6 class="text-uppercase small fw-bold opacity-75">Cancelled</h6>
          <h2 class="fw-extrabold mb-0">{{ stats.cancelledOrdersCount || 0 }}</h2>
          <i class="fa fa-circle-xmark icon-bg"></i>
          <small class="d-block mt-2 opacity-50 info-text"
            >View details <i class="fa fa-chevron-right ms-1"></i
          ></small>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-lg-8">
        <div class="card border-0 shadow-sm p-4 h-100">
          <h5 class="fw-bold mb-4 text-dark d-flex align-items-center">
            <span class="bg-primary-subtle p-2 rounded-3 me-2"></span>
            Top Performing Products
          </h5>
          <div class="table-responsive">
            <table class="table table-hover align-middle custom-table">
              <thead>
                <tr class="text-muted border-bottom">
                  <th class="py-3">Product Name</th>
                  <th class="text-center py-3">Units Sold</th>
                  <th class="text-end py-3">Net Revenue</th>
                </tr>
              </thead>
              <tbody>
                @for (item of topProducts; track item.productName) {
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="avatar-sm bg-light rounded-circle p-2 me-3 text-center">
                          <i class="fa fa-box text-secondary"></i>
                        </div>
                        <span class="fw-bold text-dark">{{ item.productName }}</span>
                      </div>
                    </td>
                    <td class="text-center">
                      <span class="badge bg-soft-primary text-primary rounded-pill px-3">
                        {{ item.totalSold }}
                      </span>
                    </td>
                    <td class="text-end text-success fw-bold">
                      {{ item.totalRevenue | number: '1.0-0' }} EGP
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card border-0 shadow-sm p-4 h-100">
          <h5 class="fw-bold mb-4 text-dark border-bottom pb-3">
            <i class="fa fa-bell me-2 text-warning"></i>Inventory Alerts
          </h5>
          <div class="list-group list-group-flush">
            @for (item of stats.lowStockItems; track item.name) {
              <div
                class="list-group-item d-flex justify-content-between align-items-center px-3 border-0 mb-3 bg-light-danger rounded-4 p-3 border-start border-4 border-danger alert-item shadow-sm"
              >
                <div class="d-flex align-items-center">
                  <div class="bg-danger-subtle rounded-circle p-2 me-2">
                    <i class="fa fa-exclamation-triangle text-danger small"></i>
                  </div>
                  <div>
                    <h6 class="mb-0 small fw-bold text-dark">{{ item.name }}</h6>
                    <small class="text-danger fw-bold">Only {{ item.quantity }} left</small>
                  </div>
                </div>
                <button
                  class="btn btn-sm btn-dark rounded-circle shadow-sm"
                  (click)="restockItem()"
                >
                  <i class="fa fa-plus"></i>
                </button>
              </div>
            } @empty {
              <div class="text-center py-5">
                <div class="bg-success-subtle d-inline-block rounded-circle p-4 mb-3">
                  <i class="fa fa-check-circle text-success fa-3x"></i>
                </div>
                <p class="text-muted fw-bold">Stock is Healthy!</p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>
